

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The LOTlib3 library &#8212; The pLoT: A course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '8_lab';</script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reading" href="8_reading.html" />
    <link rel="prev" title="Lecture" href="8_lecture.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="evaluation.html">Evaluations &amp; project topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">Running code in labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="askquestion.html">Ask a question!</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Foundations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="1_topfile.html">Week 1 - Introduction and Plan</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="1_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="2_topfile.html">Week 2 - LoT Hypothesis I</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="2_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="3_topfile.html">Week 3 - LoT Hypothesis II</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="3_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_lab.html">Python refresher: Part II</a></li>

<li class="toctree-l2"><a class="reference internal" href="3_reading.html">Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_supplementaryLecture.html">Supplementary content</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="4_topfile.html">Week 4 - Formal Grammars</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="4_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="5_topfile.html">Week 5 - Semantics</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="5_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="6_topfile.html">Week 6 - Bayes I</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="6_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="7_topfile.html">Week 7 - Bayes II</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="7_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_reading.html">Reading</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The probabilistic LoT</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="8_topfile.html">Week 8 - LOTlib3</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="8_lecture.html">Lecture</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="9_topfile.html">Week 9 - Categorization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="9_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="10_topfile.html">Week 10 - Case studies I</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="10_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="11_topfile.html">Week 11 - Case studies II</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="11_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_lab_solved.html">Lab (Solved)</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_reading.html">Reading</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="12_topfile.html">Week 12 - DreamCoder and Conclusions</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="12_lecture.html">Lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_lab.html">Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_lab_solved.html">Lab (Solved)</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_reading.html">Reading</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/thelogicalgrammar/pLoT_course/blob/master/book/8_lab.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/thelogicalgrammar/pLoT_course" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/thelogicalgrammar/pLoT_course/issues/new?title=Issue%20on%20page%20%2F8_lab.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/8_lab.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The LOTlib3 library</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-domain-an-inference-problem">Setting up a domain &amp; an inference problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-domain">A simple domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-domain-grammar">Defining a domain grammar</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-hypothesis">Defining a hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-0s-to-the-grammar">Adding 0s to the grammar</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-data-storage">Defining a data storage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-data-in-a-hypothesis">Putting data in a hypothesis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-inference">Running the inference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#things-to-try-out">Things to try out</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="the-lotlib3-library">
<h1>The LOTlib3 library<a class="headerlink" href="#the-lotlib3-library" title="Permalink to this headline">#</a></h1>
<blockquote>
<div><p><strong><strong>NOTE</strong></strong> This is based on Piantadosi’s introduction to LOTlib3, which you can find <a class="reference external" href="https://github.com/piantado/LOTlib3/blob/master/Documentation/Tutorial.md">here</a>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># in colab</span>
    <span class="kn">import</span> <span class="nn">google.colab</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In colab, downloading LOTlib3&#39;</span><span class="p">)</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/thelogicalgrammar/LOTlib3
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># not in colab</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not in colab!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Not in colab!
</pre></div>
</div>
</div>
</div>
<section id="setting-up-a-domain-an-inference-problem">
<h2>Setting up a domain &amp; an inference problem<a class="headerlink" href="#setting-up-a-domain-an-inference-problem" title="Permalink to this headline">#</a></h2>
<p>LOTlib3 is an inference library. Specifically, it infers compositions of functions from observations of inputs-outputs or just outputs (if there is no input). Today we will consider a simple inference problem and how to solve it using LOTlib3.</p>
<section id="a-simple-domain">
<h3>A simple domain<a class="headerlink" href="#a-simple-domain" title="Permalink to this headline">#</a></h3>
<p>Suppose that you know some basic arithmetic operations, our <em>primitives</em> in this domain:</p>
<ul class="simple">
<li><p>addition (+)</p></li>
<li><p>subtraction (-)</p></li>
<li><p>multiplication (*)</p></li>
<li><p>division (/)</p></li>
</ul>
<p>We can use these primitives to define a simple CFG:
$$
S \to (S + S) \mid (S - S) \mid (S * S) \mid (S / S) \mid 1 \mid … \mid 10
$$</p>
<p>Each production of this CFG can be interpreted into a (rationa) number. The interpretation of this CFG is given by usual arithmetic. Note that it is possible to encode any number with an infinite variety of possible expressions in this CFG. For instance, 12 may be written as $(1+1) * 6$, or it may have been written as $1 + 11$, or $2 * 3 * 2$, etc.:</p>
<div class="amsmath math notranslate nohighlight" id="equation-1b544ae0-2a35-4f62-92ae-967325df610b">
<span class="eqno">(4)<a class="headerlink" href="#equation-1b544ae0-2a35-4f62-92ae-967325df610b" title="Permalink to this equation">#</a></span>\[\begin{align}
(1+1) * 6 &amp;= 12 \\
12+(1-1+1-1+1-1+1-1+1-1+1-1+1-1+1-1) &amp;= 12
\end{align}\]</div>
<p>In order to transform this CFG into a PCFG, we need to assign a probability to each production rule. A natural way of doing it is as follows (with unnormalized probabilities):</p>
<div class="amsmath math notranslate nohighlight" id="equation-3fea5c88-2d28-4a50-9547-261eaa0606d8">
<span class="eqno">(5)<a class="headerlink" href="#equation-3fea5c88-2d28-4a50-9547-261eaa0606d8" title="Permalink to this equation">#</a></span>\[\begin{align}
(S + S) &amp; \to 1.0 &amp;\text{Operators get the same probability} \\
(S - S) &amp; \to 1.0 \\
(S * S) &amp; \to 1.0 \\
(S / S) &amp; \to 1.0 \\
1 &amp; \to 10*\frac{1}{1^2} &amp;\text{Numerals get different probabilities} \\
&amp;... \\
10 &amp; \to 10*\frac{1}{10^2} 
\end{align}\]</div>
<p>We use probability $\frac{1}{n^2}$ for numeral $n$ so that numerals referring to smaller numbers get a higher prior probability of appearing in a formula, but we also multiply all probabilities by 10 to increase the total probability of producing a numeral over the other productions.</p>
<p>Here is a possible production from this grammar:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b730c169-e39e-414b-9c58-0566162469ec">
<span class="eqno">(6)<a class="headerlink" href="#equation-b730c169-e39e-414b-9c58-0566162469ec" title="Permalink to this equation">#</a></span>\[\begin{align}
S
&amp;\to (S+S) \\
&amp;\to ((S/S)+S) \\
&amp;\to ((1/S)+S) \\
&amp;\to ((1/(S-S))+S) \\
&amp;\to ((1/(2-S))+S) \\
&amp;\to ((1/(2-1))+S) \\
&amp;\to ((1/(2-1))+(S-S)) \\
&amp;\to ((1/(2-1))+(4-S)) \\
&amp;\to ((1/(2-1))+(4-2)) \\
\end{align}\]</div>
<p>And this expression evaluates to the number 3!</p>
<p>This should all be familiar from previous classes. However, now we add something new, which is at the very core of the LoT project. Suppose you have the following problem: You observe a number, and you want to infer which formula in the PCFG above generated it. To address this problem, we will need to combine all the topics we have covered so far. The general plan is:</p>
<ol class="arabic simple">
<li><p>We define a PCFG, which gives us a prior probability $P(s)$ over productions $s$ from the CFG.</p></li>
<li><p>We define a likelihood function $P(o \mid s)$, which gives us the probability of an observation (or set of observations) $o$ given a production $s$ from the PCFG.</p></li>
<li><p>Given some data $o$, we run approximated Bayesian inference to find a posterior distribution $P(s \mid o)$.</p></li>
</ol>
<p>For instance, suppose you observe the single number 12. There are lots of ways (infinitely many) to generate 12.  Which one is correct?  Ay composition of addition, subtraction, multiplication, etc. that outputs a 12 would be <em>consistent</em> with the data. However, some seem more plausible than others. For instance it might be unlikely the 12 was generated as $12+(1-1+1-1+1-1+1-1)$ as it seems an unnecessarily complex way to arrive at 12.  LOTLib3 is designed to help you make sensible decisions about which compositions of functions likely explain a particular set of outputs or input-output pairs.</p>
</section>
<section id="defining-a-domain-grammar">
<h3>Defining a domain grammar<a class="headerlink" href="#defining-a-domain-grammar" title="Permalink to this headline">#</a></h3>
<p>The general strategy of LOTlib3 models is to start by specifying a probabilistic context-free grammar (with one small exception described below) that specifies a prior distribution on trees, or equivalently compositional structures like $(1+1)<em>6$, $2+2+2+2+2+2$, $(1+1)+(2</em>5)$, etc. We set the grammar up so that each production from it will be a valid Python expression, which can be interpreted automatically rather than manually.</p>
<p>Let’s see how to construct a simple example grammar step-by-step. First, we import the Grammar class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LOTlib3.Grammar</span> <span class="kn">import</span> <span class="n">Grammar</span>
</pre></div>
</div>
</div>
</div>
<p>Second, we define a grammar object (By default this has a start symbol called ‘START’ but we want to call it ‘EXPR’):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span> <span class="o">=</span> <span class="n">Grammar</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;EXPR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">grammar</span></code> object will contain the information about our PCFG.</p>
<p>Third, we add the substitution rules to the grammar, along with the (unnormalized) probabilities of each rule:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some operations</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1"> * </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(float(</span><span class="si">%s</span><span class="s1">) / float(</span><span class="si">%s</span><span class="s1">))&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(-</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># And define some numbers. We&#39;ll give them a 1/(n^2) probability</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">10.0</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The grammar rules have the format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">NONTERMINAL</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">FUNCTION</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ARGUMENTS</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">PROBABILITY</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;NONTERMINAL&gt;</span></code> says what nonterminal this rule is expanding (the left side of a substitution rule). In this example, there is only one kind of nonterminal, an expression (denoted <code class="docutils literal notranslate"><span class="pre">EXPR</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> does two things at once: first, it defines the right side of the substitution rule, and second it specifies the its interpretation (the Python function that this rule represents). <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> is a string which contain either predefined functions in LOTlib3 or some other valid Python code. In the latter case (as in the example above), the string can contain a <code class="docutils literal notranslate"><span class="pre">%s</span></code> wherever there is a nonterminal in the substitution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code> specifies which nonterminal(s) appear in the right-hand side of the substitution described in <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code>. <code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code> is a list containing one element for each <code class="docutils literal notranslate"><span class="pre">%s</span></code> in <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code>. Each <code class="docutils literal notranslate"><span class="pre">%s</span></code> in <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> gets substituted via string substitution with the corresponding nonterminal in <code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code>. For instance,  if <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">(%s+%s)</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">['EXPR',</span> <span class="pre">'EXPR']</span></code>, the whole right side of the replacement rule is <code class="docutils literal notranslate"><span class="pre">EXPR</span> <span class="pre">+</span> <span class="pre">EXPR</span></code>, and it is interpreted as the function <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,y:</span> <span class="pre">x+y</span></code>. Note that the <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> string can be pretty complex. For division, we have <code class="docutils literal notranslate"><span class="pre">(float(%s)</span> <span class="pre">/</span> <span class="pre">float(%s))</span></code>, using some Python operations.</p></li>
<li><p>NOTE: A generation from the grammar is interpreted with <code class="docutils literal notranslate"><span class="pre">eval</span></code>, which is why we can use Python expressions.</p></li>
<li><p>A terminal is any rule with <code class="docutils literal notranslate"><span class="pre">None</span></code> or an empty list as <code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code>.</p></li>
</ul>
<p>If the <code class="docutils literal notranslate"><span class="pre">&lt;FUNCTION&gt;</span></code> is a terminal that does not take arguments (as in the numbers 0..9), the <code class="docutils literal notranslate"><span class="pre">&lt;ARGUMENTS&gt;</span></code> part of a rule should be None. None is very different from an empty list, since an empty list corresponds to a function with zero arguments, while None to a constant expression (not a function):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>renders into the program <code class="docutils literal notranslate"><span class="pre">hello</span></code> but</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>renders into <code class="docutils literal notranslate"><span class="pre">hello()</span></code>.</p>
<p>We can see some productions from this grammar if we call <code class="docutils literal notranslate"><span class="pre">Grammar.generate</span></code>. We will also show the probability of this tree according to the grammar, which is computed by renormalizing the <code class="docutils literal notranslate"><span class="pre">&lt;PROBABILITY&gt;</span></code> values of each rule when expanding each nonterminal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grammar</span><span class="o">.</span><span class="n">log_probability</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-3.8814440645728694 5
-0.6625682397046684 1
-2.048862600824559 2
-19.92698669181795 (3 * (-(float(1) / float((5 + 1)))))
-0.6625682397046684 1
-3.43515696194445 4
-2.048862600824559 2
-3.6277215724033827 (-1)
-0.6625682397046684 1
-0.6625682397046684 1
</pre></div>
</div>
</div>
</div>
<p>As you can see, the longer/bigger trees have lower (more negative) probabilities, implementing essentially a simplicity bias. These PCFG probabilities will often be our prior for Bayesian inference.</p>
<p>Note that even though each <code class="docutils literal notranslate"><span class="pre">t</span></code> is a tree (a hierarchy of <code class="docutils literal notranslate"><span class="pre">LOTlib3.FunctionNodes</span></code>), it renders nicely above as a string. This is how expressions are evaluated in Python by default. But we can see more of the internal structure using <code class="docutils literal notranslate"><span class="pre">t.fullprint()</span></code>, which shows the nonterminals, functions, and arguments at each level:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">grammar</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">fullprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> EXPR (%s * %s) 	 None
  .   EXPR (-%s) 	 None
  .    .   EXPR 1 	 None
  .   EXPR (%s * %s) 	 None
  .    .   EXPR 1 	 None
  .    .   EXPR 1 	 None
</pre></div>
</div>
</div>
</div>
<p>There is a column in this output that should say ‘None’ for each row of the output.  It is ok to ignore that for now.</p>
</section>
<section id="defining-a-hypothesis">
<h3>Defining a hypothesis<a class="headerlink" href="#defining-a-hypothesis" title="Permalink to this headline">#</a></h3>
<p>We have seen above how to specify a grammar, encoding a space of expressions and their interpretation. However, before we can run inference with some observation, we need some way of encoding functions for computing the prior and the likelihood of data, as well as other information we might need about the thing we want to infer. All this information could be stored in various way, but in LOTlib3 we encode it by defining a class (which we call the <code class="docutils literal notranslate"><span class="pre">Hypothesis</span></code> class) that inherits from a predefined <code class="docutils literal notranslate"><span class="pre">LOTHypothesis</span></code> class (there are other Hypothesis classes to inherit from but do not worry about that for now). We will call `hypotheses’ the specific objects defined from this class.</p>
<blockquote>
<div><p><strong>NOTE</strong> An hypothesis in LOTlib3 is not a <em>specific</em> hypothesis produced by the PCFG, but rather just a way of encoding the stuff we need to run inference, including a likelihood function and a prior function. Essentially, we need it to pass information about the inference problem to the inference function.</p>
</div></blockquote>
<p>Let’s look how this is done by defining a Hypothesis class <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code> for the PCFG above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">exp</span>
<span class="kn">from</span> <span class="nn">LOTlib3.Hypotheses.LOTHypothesis</span> <span class="kn">import</span> <span class="n">LOTHypothesis</span>

<span class="c1"># define a hypothesis</span>
<span class="k">class</span> <span class="nc">MyHypothesis</span><span class="p">(</span><span class="n">LOTHypothesis</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># initialize by running the superclass&#39; init</span>
        <span class="c1"># with the appropriate arguments.</span>
        <span class="n">LOTHypothesis</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">grammar</span><span class="o">=</span><span class="n">grammar</span><span class="p">,</span> 
            <span class="n">display</span><span class="o">=</span><span class="s2">&quot;lambda: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> 
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_single_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the loglikelihood function P(datum | self)&quot;&quot;&quot;</span>
        <span class="c1"># probability of a random number btw 1 and 100</span>
        <span class="c1"># being observed by noise rather than the true number</span>
        <span class="n">prob_of_random_number</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">datum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span>
        <span class="c1"># If the hypothesis called with the datum&#39;s input</span>
        <span class="c1"># is equal to the output...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">datum</span><span class="o">.</span><span class="n">input</span><span class="p">)</span> <span class="o">==</span> <span class="n">datum</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="c1"># return the logprobability!</span>
            <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">prob_of_random_number</span> <span class="o">+</span> <span class="n">datum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">prob_of_random_number</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>There are a few things going on here. First, we import LOTHypothesis and use that to define the new class <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code>. The <code class="docutils literal notranslate"><span class="pre">self</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code> can be called like a function, and in a specific instantiation of <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code> that function will be the interpreted hypothesis (more on this below).</p>
<p>Then, we define the initializer <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, which calls the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> of the superclass <code class="docutils literal notranslate"><span class="pre">LOTHypothesis</span></code>. The <code class="docutils literal notranslate"><span class="pre">LOTHypothesis</span></code> init takes various arguments. First, a <code class="docutils literal notranslate"><span class="pre">grammar</span></code> argument to specify a Grammar object; in our case, we specify that the grammar we want is the one defined above, <code class="docutils literal notranslate"><span class="pre">grammar</span></code>. Then, the <code class="docutils literal notranslate"><span class="pre">display</span></code> argument, which allows us to specify how we want the Hypotheses to be displayed. When we convert the value of the hypothesis into a string, it will get substituted into the <code class="docutils literal notranslate"><span class="pre">display</span></code> keyword. Here, <code class="docutils literal notranslate"><span class="pre">display=&quot;lambda:</span> <span class="pre">%s&quot;</span></code> means that the hypothesis will be displayed and also evaled in python as appearing after a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> without any arguments.</p>
<p>The second thing we have done when defining <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code> is defining a method <code class="docutils literal notranslate"><span class="pre">compute_single_likelihood</span></code>. What does this function do, conceptually? It takes a single observation and returns the logarithm of the likelihood given the (currently considered) hypothesis: $P(\mathrm{observation} \mid \mathrm{hypothesis})$. We get to decide what the value of this probability is. Note that in general each production from our PCFG can encode a function. In that case the observations are (input, output) tuples, where the output is obtained by running the input through the (unknown) interpreted PCFG production. Therefore, in general we need the following components to write the likelihood function:</p>
<ul class="simple">
<li><p>An observation, containing an input, an output, and whatever other parameters we need to calculate the likelihood.</p></li>
<li><p>A way of calling the input on the currently entertained hypothesis.</p></li>
</ul>
<p>Practically, <code class="docutils literal notranslate"><span class="pre">compute_single_likelihood</span></code> expects an argument <code class="docutils literal notranslate"><span class="pre">datum</span></code>; <code class="docutils literal notranslate"><span class="pre">datum</span></code> must have attributes <code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">output</span></code>, and whatever other parameters we need for the calculation of the likelihood (in this case, <code class="docutils literal notranslate"><span class="pre">alpha</span></code>). The LOTHypothesis <code class="docutils literal notranslate"><span class="pre">self</span></code> can be viewed as the function encoding the currently considered hypothesis (here, one with no arguments) and so it can be called on <code class="docutils literal notranslate"><span class="pre">datum.input</span></code>. When we construct a hypothesis object, a random production is drawn from the PCFG; when we use the hypothesis object as part of the inference, the initial hypothesis stored in the object is updated with a new production on every step of the MCMC run, and <code class="docutils literal notranslate"><span class="pre">self</span></code> (which is the interpretation of the production as a callable python function) changes accordingly; more on this below when we look at how hypothesis objects are used for inference.</p>
<p>In the specific likelihood function defined above, we generate a random number from 1 to 100 with probability <code class="docutils literal notranslate"><span class="pre">1-datum.alpha</span></code> and the correct number with probability <code class="docutils literal notranslate"><span class="pre">datum.alpha</span></code>. Thus, when the hypothesis returns the correct value (e.g. <code class="docutils literal notranslate"><span class="pre">self(*datum.input)</span> <span class="pre">==</span> <span class="pre">datum.output</span></code>) we must add these quantities to get the total probability of producing the data. When it does not, we must return only the former. <code class="docutils literal notranslate"><span class="pre">LOTlib3.Hypotheses.Likelihoods</span></code> defines a number of other standard likelihoods, including the most commonly used  one, <code class="docutils literal notranslate"><span class="pre">BinaryLikelihood</span></code>.</p>
<p>LOTHypothesis defines <code class="docutils literal notranslate"><span class="pre">compute_prior()</span></code> and <code class="docutils literal notranslate"><span class="pre">compute_likelihood(data)</span></code>. Essentially, <code class="docutils literal notranslate"><span class="pre">compute_likelihood</span></code> maps <code class="docutils literal notranslate"><span class="pre">compute_single_likelihood</span></code> over a list of data (treating each as independent identically-distributed conditioned on the hypothesis). So when we want to define how the likelihood works, we typically want to overwrite <code class="docutils literal notranslate"><span class="pre">compute_single_likelihood</span></code> as we have above.</p>
</section>
<section id="adding-0s-to-the-grammar">
<h3>Adding 0s to the grammar<a class="headerlink" href="#adding-0s-to-the-grammar" title="Permalink to this headline">#</a></h3>
<p>As you might have noticed we did not allow the number 0 as a terminal value in our grammar.  This is because it ran the risk of a divide by zero error.  However, we might like to include all the numbers between zero and nine.  So let’s change that one part of our grammar definiton by replacing the lines where the number substitution rules are defined. First, define a clean grammar and add the operators:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar</span> <span class="o">=</span> <span class="n">Grammar</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;EXPR&#39;</span><span class="p">)</span>

<span class="c1"># Define the same operations as above</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1"> * </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(float(</span><span class="si">%s</span><span class="s1">) / float(</span><span class="si">%s</span><span class="s1">))&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="s1">&#39;(-</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EXPR&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EXPR -&gt; (-%s)[&#39;EXPR&#39;]	w/ p=1.0
</pre></div>
</div>
</div>
</div>
<p>Then, add the number replacement rules including 0 with the new probabilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some numbers. </span>
<span class="c1"># We&#39;ll give them a 1/((n+1)^2) probability</span>
<span class="c1"># so that 0 naturally gets a probability.</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">grammar</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="s1">&#39;EXPR&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">10.0</span><span class="o">/</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have a problem, namely, it can happen that the grammar generates an expression like <code class="docutils literal notranslate"><span class="pre">1/0</span></code>, with a zero in the demoninator. This will generate a divide by zero error when evaluated by the Python interpreter. How do we deal with this? Fortunately, we can hack our hypothesis class to address this by catching the exception. A smart way to do this is to override <code class="docutils literal notranslate"><span class="pre">__call__</span></code> and return an appropriate value when such an error occurs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyHypothesis</span><span class="p">(</span><span class="n">LOTHypothesis</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">LOTHypothesis</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="o">=</span><span class="n">grammar</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s2">&quot;lambda: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># try to do it from the superclass</span>
            <span class="k">return</span> <span class="n">LOTHypothesis</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="c1"># and if we get an error, return nan</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_single_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">datum</span><span class="o">.</span><span class="n">input</span><span class="p">)</span> <span class="o">==</span> <span class="n">datum</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">datum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span> <span class="o">+</span> <span class="n">datum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">log</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">datum</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-a-data-storage">
<h3>Defining a data storage<a class="headerlink" href="#defining-a-data-storage" title="Permalink to this headline">#</a></h3>
<p>Given that our hypothesis wants those kinds of data, we can then create data as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LOTlib3.DataAndObjects</span> <span class="kn">import</span> <span class="n">FunctionData</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="c1"># a single datum</span>
    <span class="n">FunctionData</span><span class="p">(</span>
        <span class="c1"># input is empty since we are </span>
        <span class="c1"># encoding a single number</span>
        <span class="nb">input</span><span class="o">=</span><span class="p">[],</span> 
        <span class="c1"># the observation we want to encode</span>
        <span class="n">output</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> 
        <span class="c1"># the probability of </span>
        <span class="c1"># observing the true number</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.999</span>
    <span class="p">)</span> 
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note here that the most natural form of data is a list–even if it is only a single element–where each element, a datum, gets passed to <code class="docutils literal notranslate"><span class="pre">compute_single_likelihood</span></code>. The data here specifies the input, output, and noise value <code class="docutils literal notranslate"><span class="pre">alpha</span></code>. Note that even though <code class="docutils literal notranslate"><span class="pre">alpha</span></code> could live as an attribute of hypotheses, it makes most sense to view it as a known part of the data. Here input is a empty list because there is no input!  Remember the example we started with was explaining a single output (the number 12).  Keep reading to understand examples with an input below!</p>
</section>
<section id="putting-data-in-a-hypothesis">
<h3>Putting data in a hypothesis<a class="headerlink" href="#putting-data-in-a-hypothesis" title="Permalink to this headline">#</a></h3>
<p>We may now use our definition of a hypothesis to make one. If we call the initializer without a <code class="docutils literal notranslate"><span class="pre">value</span></code> keyword, LOTHypothesis just samples it from the given grammar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">MyHypothesis</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">compute_prior</span><span class="p">(),</span> <span class="n">h</span><span class="o">.</span><span class="n">compute_likelihood</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-14.800602876662946 -9.210340371976182 lambda: (0 + (4 + (0 + 0)))
</pre></div>
</div>
</div>
</div>
<p>Even better, <code class="docutils literal notranslate"><span class="pre">MyHypothesis</span></code> also inherits a <code class="docutils literal notranslate"><span class="pre">compute_posterior</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">compute_posterior</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">h</span><span class="o">.</span><span class="n">compute_prior</span><span class="p">(),</span> <span class="n">h</span><span class="o">.</span><span class="n">compute_likelihood</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-24.01094324863913 -14.800602876662946 -9.210340371976182 lambda: (0 + (4 + (0 + 0)))
</pre></div>
</div>
</div>
</div>
<p>For convenience, when <code class="docutils literal notranslate"><span class="pre">compute_posterior</span></code> is called, it sets attributes on <code class="docutils literal notranslate"><span class="pre">h</span></code> for the prior, likelihood, and unnormalized posterior (i.e., log(prior times likelihood)):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">MyHypothesis</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">compute_posterior</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-9.878050625235126 -0.6677102532589441 -9.210340371976182 lambda: 0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="running-the-inference">
<h2>Running the inference<a class="headerlink" href="#running-the-inference" title="Permalink to this headline">#</a></h2>
<p>We are almost there. We have done the following:</p>
<ul class="simple">
<li><p>Defined a grammar object that encodes our PCFG</p></li>
<li><p>Defined a hypothesis object which uses the grammar to calculate a prior and also includes a function to calculate a likelihood.</p></li>
<li><p>Defined a list containing data objects, which encode the observed data as well as parameters needed to calculate the likelihood.</p></li>
</ul>
<p>Now we can see the main point of LOTlib3: we can simply import MCMC routines and do inference over the space defined by the grammar. To do this, we first import the Metropolis Hastings sampler:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">LOTlib3.Samplers.MetropolisHastings</span> <span class="kn">import</span> <span class="n">MetropolisHastingsSampler</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we define a starting hypothesis, which internally samples an initial random guess from the PCFG:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define a &quot;starting hypothesis&quot;. This one is essentially copied by </span>
<span class="c1"># all proposers, so the sampler doesn&#39;t need to know its type or anything. </span>
<span class="n">h0</span> <span class="o">=</span> <span class="n">MyHypothesis</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we use the sampler like an iterator. MetropolisHastingsSampler takes the hypothesis object, the observed data, and the number of posterior samples we want to take, and produces the samples using the MCMC algorithm. MetropolisHastingsSampler calls the hypothesis’ <code class="docutils literal notranslate"><span class="pre">compute_posterior</span></code> so when we have an <code class="docutils literal notranslate"><span class="pre">h</span></code> we can get its prior and likelihood:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">MetropolisHastingsSampler</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prior:                    &#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">prior</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Likelihood:               &#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">likelihood</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(Unnormalized) posterior: &#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hypothesis:               &#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Interpretation:           &#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-13.566930079349062 -2.054004614378835 -11.512925464970227 lambda: 1
Prior:                     0.12822040082201266
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  1.2822040082201285e-06
Hypothesis:                lambda: 1
Interpretation:            1

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-13.566930079349062 -2.054004614378835 -11.512925464970227 lambda: 1
Prior:                     0.12822040082201266
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  1.2822040082201285e-06
Hypothesis:                lambda: 1
Interpretation:            1

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-13.566930079349062 -2.054004614378835 -11.512925464970227 lambda: 1
Prior:                     0.12822040082201266
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  1.2822040082201285e-06
Hypothesis:                lambda: 1
Interpretation:            1

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0

-12.180635718229171 -0.6677102532589441 -11.512925464970227 lambda: 0
Prior:                     0.5128816032880508
Likelihood:                1.0000000000000016e-05
(Unnormalized) posterior:  5.128816032880515e-06
Hypothesis:                lambda: 0
Interpretation:            0
</pre></div>
</div>
</div>
</div>
<p>Just looking at a list of individual samples is not a very practical way of analysing the results of an MCMC run. A cleaner way of storing the posterior samples is to accumulate them in a Counter, using the hypotheses as keys and the counts as values. Let’s first get the samples and put them in the counter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">h0</span> <span class="o">=</span> <span class="n">MyHypothesis</span><span class="p">()</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">MetropolisHastingsSampler</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">count</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>And now we can print them out, in order of increasing posterior probability. If the above worked correctly, many of the most likely hypotheses should evaluate to the number 12:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="n">x</span><span class="p">])[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Count:          &#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">[</span><span class="n">h</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Posterior:      &#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hypothesis:     &#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Interpretation: &#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Count:           886
Posterior:       8.863300048096163e-07
Hypothesis:      lambda: ((4 + 0) * 3)
Interpretation:  12

Count:           1140
Posterior:       2.2158250120240445e-07
Hypothesis:      lambda: (3 + (9 + 0))
Interpretation:  12

Count:           1189
Posterior:       6.655737304579818e-06
Hypothesis:      lambda: (4 + 8)
Interpretation:  12

Count:           1299
Posterior:       8.863300048096163e-07
Hypothesis:      lambda: ((0 + 4) * 3)
Interpretation:  12

Count:           1547
Posterior:       1.2822040082201285e-06
Hypothesis:      lambda: 1
Interpretation:  1

Count:           6172
Posterior:       5.128816032880515e-06
Hypothesis:      lambda: 0
Interpretation:  0

Count:           7500
Posterior:       3.36946701044353e-05
Hypothesis:      lambda: (3 * 4)
Interpretation:  12

Count:           13781
Posterior:       3.056205905164204e-05
Hypothesis:      lambda: (6 * 2)
Interpretation:  12

Count:           19710
Posterior:       8.423667526108823e-06
Hypothesis:      lambda: (3 + 9)
Interpretation:  12

Count:           27273
Posterior:       3.36946701044353e-05
Hypothesis:      lambda: (4 * 3)
Interpretation:  12
</pre></div>
</div>
</div>
</div>
<p>LOTlib3 hypotheses are required to hash nicely, meaning that they can be saved or put into dictionaries and sets like this.</p>
<p>If our sampler is working correctly, it should be the case that the time average of the sampler (the hypotheses from the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop) should approximate the posterior distribution (e.g. their re-normalized scores). Let’s check if that’s true:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Miscellaneous stores a number of useful functions. Here, we need logsumexp, which will</span>
<span class="c1"># compute the normalizing constant for posterior_scores when they are in log space</span>
<span class="kn">from</span> <span class="nn">LOTlib3.Miscellaneous</span> <span class="kn">import</span> <span class="n">logsumexp</span>
<span class="c1"># but things that are handy in numpy are not duplicated (usually)</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span> 

<span class="c1"># get a list of all the hypotheses we found. </span>
<span class="c1"># This is necessary because we need a fixed order,</span>
<span class="c1"># which count.keys() does not guarantee </span>
<span class="c1"># unless we make a new variable. </span>
<span class="n">hypotheses</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> 

<span class="c1"># first convert posterior_scores to probabilities. To this, we&#39;ll use a simple hack of </span>
<span class="c1"># renormalizing the posterior_scores that we found. This is a better estimator of each hypothesis&#39;</span>
<span class="c1"># probability than the counts from the sampler</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">logsumexp</span><span class="p">([</span>
    <span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span> 
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hypotheses</span>
<span class="p">])</span>

<span class="n">posterior_probabilities</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="n">exp</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">posterior_score</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hypotheses</span> 
<span class="p">]</span>

<span class="c1"># and compute the probabilities over the sampler run</span>
<span class="n">cntz</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>    
<span class="n">sampler_counts</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">cntz</span> 
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hypotheses</span> 
<span class="p">]</span> 

<span class="c1">## and let&#39;s just make a simple plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">posterior_probabilities</span><span class="p">,</span> <span class="n">sampler_counts</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Approximated posterior probabilities&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized sampler counts&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/617995945ad333c0f11ada16e4a9a75ddeefa5328480837e404713456a4bdc1b.png" src="_images/617995945ad333c0f11ada16e4a9a75ddeefa5328480837e404713456a4bdc1b.png" />
</div>
</div>
</section>
<section id="things-to-try-out">
<h2>Things to try out<a class="headerlink" href="#things-to-try-out" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>What happens if we make the $\alpha$ higher or lower?</p></li>
<li><p>What happens to the inferred hypotheses if we add another datapoint with a different number?</p></li>
<li><p>What happens if we decrease the prior weight of the numerals?</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "lot"
        },
        kernelOptions: {
            name: "lot",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'lot'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="8_lecture.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture</p>
      </div>
    </a>
    <a class="right-next"
       href="8_reading.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reading</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-domain-an-inference-problem">Setting up a domain &amp; an inference problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-domain">A simple domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-domain-grammar">Defining a domain grammar</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-hypothesis">Defining a hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-0s-to-the-grammar">Adding 0s to the grammar</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-data-storage">Defining a data storage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-data-in-a-hypothesis">Putting data in a hypothesis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-inference">Running the inference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#things-to-try-out">Things to try out</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fausto Carcassi
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>